<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoSphere Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
  /* Enhanced Color System with HSL for better control */
  --primary-hue: 120;
  --primary-saturation: 61%;
  --primary-lightness: 39%;
  
  --primary: hsl(var(--primary-hue), var(--primary-saturation), var(--primary-lightness));
  --primary-light: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) + 15%));
  --primary-dark: hsl(var(--primary-hue), var(--primary-saturation), calc(var(--primary-lightness) - 10%));
  --primary-fade: hsla(var(--primary-hue), var(--primary-saturation), var(--primary-lightness), 0.1);
  
  --text: hsl(0, 0%, 13%);
  --text-light: hsl(0, 0%, 45%);
  --text-lighter: hsl(0, 0%, 65%);
  
  --bg: hsl(60, 56%, 95%);
  --card: hsl(0, 0%, 98%);
  --sidebar: hsl(120, 33%, 94%);
  --sidebar-text: hsl(0, 0%, 38%);
  --border: hsl(0, 0%, 88%);
  
  --success: hsl(120, 61%, 50%);
  --warning: hsl(36, 100%, 50%);
  --danger: hsl(4, 90%, 58%);
  --info: hsl(207, 90%, 54%);
  
  --shadow-sm: 0 1px 3px hsla(0, 0%, 0%, 0.05);
  --shadow-md: 0 4px 12px hsla(0, 0%, 0%, 0.08);
  --shadow-lg: 0 10px 25px hsla(0, 0%, 0%, 0.1);
  --shadow-xl: 0 20px 50px hsla(0, 0%, 0%, 0.15);
  
  --glass-bg-light: hsla(0, 0%, 100%, 0.2);
  --glass-border-light: hsla(0, 0%, 100%, 0.25);
  --glass-shadow-light: 0 8px 32px hsla(208, 100%, 50%, 0.15);
  
  --radius-sm: 4px;
  --radius-md: 8px;
  --radius-lg: 12px;
  --radius-xl: 16px;
  --radius-full: 9999px;
  
  --space-xs: 4px;
  --space-sm: 8px;
  --space-md: 16px;
  --space-lg: 24px;
  --space-xl: 32px;
  --space-2xl: 48px;
  
  --transition-fast: 0.15s ease;
  --transition-normal: 0.3s ease;
  --transition-slow: 0.5s ease;
  --transition-bounce: 0.5s cubic-bezier(0.68, -0.6, 0.32, 1.6);
  
  --font-size-xs: 0.75rem;
  --font-size-sm: 0.875rem;
  --font-size-md: 1rem;
  --font-size-lg: 1.125rem;
  --font-size-xl: 1.25rem;
  --font-size-2xl: 1.5rem;
  --font-size-3xl: 1.875rem;
  --font-size-4xl: 2.25rem;
  
  --z-index-base: 0;
  --z-index-above: 1;
  --z-index-dropdown: 100;
  --z-index-sticky: 200;
  --z-index-fixed: 300;
  --z-index-modal: 400;
  --z-index-toast: 500;
  --z-index-max: 9999;
}

.dark-mode {
  /* Dark Mode with HSL adjustments */
  --primary-hue: 120;
  --primary-saturation: 55%;
  --primary-lightness: 30%;
  
  --text: hsl(0, 0%, 98%);
  --text-light: hsl(0, 0%, 70%);
  --text-lighter: hsl(0, 0%, 50%);
  
  --bg: hsl(0, 0%, 7%);
  --card: hsl(0, 0%, 12%);
  --sidebar: hsl(120, 7%, 11%);
  --sidebar-text: hsl(195, 16%, 75%);
  --border: hsl(0, 0%, 20%);
  
  --glass-bg-dark: hsla(0, 0%, 12%, 0.3);
  --glass-border-dark: hsla(0, 0%, 100%, 0.1);
  --glass-shadow-dark: 0 8px 32px hsla(0, 0%, 0%, 0.3);
  
  --shadow-sm: 0 1px 3px hsla(0, 0%, 0%, 0.2);
  --shadow-md: 0 4px 12px hsla(0, 0%, 0%, 0.25);
  --shadow-lg: 0 10px 25px hsla(0, 0%, 0%, 0.3);
  --shadow-xl: 0 20px 50px hsla(0, 0%, 0%, 0.4);
}

/* Modern CSS Reset with enhancements */
*, *::before, *::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  -webkit-tap-highlight-color: transparent;
}

html {
  scroll-behavior: smooth;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  text-rendering: optimizeLegibility;
}

body {
  background-color: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  font-family: 'Poppins', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  line-height: 1.5;
  transition: background-color var(--transition-slow), color var(--transition-slow);
}

/* Typography Enhancements */
h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  line-height: 1.2;
  margin-bottom: var(--space-sm);
  color: var(--text);
}

h1 { font-size: var(--font-size-3xl); }
h2 { font-size: var(--font-size-2xl); }
h3 { font-size: var(--font-size-xl); }
h4 { font-size: var(--font-size-lg); }
h5 { font-size: var(--font-size-md); }

p {
  margin-bottom: var(--space-md);
  color: var(--text-light);
}

a {
  color: var(--primary);
  text-decoration: none;
  transition: color var(--transition-fast);
}

a:hover {
  color: var(--primary-dark);
}

/* Glassmorphism Effects */
.glass-card {
  background: var(--glass-bg-light);
  backdrop-filter: blur(16px) saturate(180%);
  -webkit-backdrop-filter: blur(16px) saturate(180%);
  border-radius: var(--radius-lg);
  border: 1px solid var(--glass-border-light);
  box-shadow: var(--glass-shadow-light);
  transition: all var(--transition-normal);
  position: relative;
  overflow: hidden;
  z-index: var(--z-index-base);
}

.glass-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.4) 0%,
    rgba(255, 255, 255, 0.1) 100%
  );
  z-index: -1;
  pointer-events: none;
  border-radius: inherit;
}

.dark-mode .glass-card {
  background: var(--glass-bg-dark);
  border: 1px solid var(--glass-border-dark);
  box-shadow: var(--glass-shadow-dark);
}

.dark-mode .glass-card::before {
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.1) 0%,
    rgba(255, 255, 255, 0.05) 100%
  );
}
        .dashboard {
            display: flex;
            min-height: 100vh;
        }

        /* Enhanced Sidebar with 3D effect */
.sidebar {
  width: 250px;
  background-color: var(--sidebar);
  color: var(--sidebar-text);
  padding: var(--space-lg) 0;
  position: fixed;
  height: 75vh;
  z-index: var(--z-index-fixed);
  overflow-y: auto;
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
  transform-style: preserve-3d;
  transform: perspective(1000px) rotateY(0deg);
  transition: transform var(--transition-normal), width var(--transition-normal);
  will-change: transform;
}

.sidebar:hover {
  transform: perspective(1000px) rotateY(-2deg);
}

.dark-mode .sidebar {
  box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
}

/* Logo with 3D tilt effect */
.logo {
  display: flex;
  align-items: center;
  padding: 0 var(--space-lg);
  margin-bottom: var(--space-xl);
  transition: all var(--transition-normal);
}

.logo:hover {
  transform: translateX(5px);
}

.logo-icon {
  width: 40px;
  height: 40px;
  background-color: var(--primary-fade);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: var(--space-sm);
  transition: all var(--transition-bounce);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.logo-icon:hover {
  transform: rotate(15deg) scale(1.1);
  background-color: var(--primary);
  box-shadow: 0 6px 12px rgba(76, 175, 80, 0.3);
}

.logo-icon i {
  font-size: var(--font-size-xl);
  color: var(--primary);
  transition: inherit;
}

.logo span {
  font-size: var(--font-size-lg);
  font-weight: 600;
  color: var(--text);
  transition: color var(--transition-normal);
}

/* Menu with advanced hover effects */
.menu {
  list-style: none;
  padding: 0 var(--space-md);
}

.menu li {
  margin-bottom: var(--space-xs);
  border-radius: var(--radius-md);
  overflow: hidden;
  transition: all var(--transition-normal);
  position: relative;
}

.menu li::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, var(--primary), transparent);
  opacity: 0;
  transition: opacity var(--transition-normal);
  z-index: -1;
}

.menu li:hover::before {
  opacity: 0.1;
}

.menu li a {
  display: flex;
  align-items: center;
  padding: var(--space-sm) var(--space-md);
  color: var(--sidebar-text);
  text-decoration: none;
  font-size: var(--font-size-sm);
  position: relative;
  z-index: var(--z-index-above);
}

.menu li a::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 3px;
  background-color: var(--primary-light);
  transform: scaleY(0);
  transform-origin: bottom;
  transition: transform var(--transition-normal);
}

.menu li a:hover::before {
  transform: scaleY(1);
}

.menu li a i {
  font-size: var(--font-size-lg);
  margin-right: var(--space-sm);
  width: 24px;
  text-align: center;
  transition: all var(--transition-bounce);
}

.menu li a:hover i {
  transform: scale(1.2);
  color: var(--primary);
}

.menu li a span {
  flex: 1;
  transition: transform var(--transition-normal);
}

.menu li a:hover span {
  transform: translateX(5px);
}

.menu li.active {
  background-color: rgba(255, 255, 255, 0.1);
}

.menu li.active a i {
  color: var(--primary);
}

.dark-mode .menu li a.active {
  background-color: var(--primary-dark);
  color: white;
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
}

        /* Dark Mode Toggle */
        .dark-mode-toggle {
            padding: 12px;
            margin-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 70px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #F5C518;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: #616161;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        input:checked + .slider {
            background-color: var(--primary-light);
        }

        input:checked + .slider:before {
            transform: translateX(30px);
            background-color: white;
        }

        .dark-mode-toggle span {
            margin-left: 12px;
            font-size: 14px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 25px;
            min-height: 100vh;
        }

        /* Page Content - Initially hidden */
        .page-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Dashboard Page (Default visible) */
        #dashboard-page {
            display: block;
        }

        /* Navbar */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .nav-title {
            padding-left: 10px;
        }

        .nav-title h1 {
            font-size: 24px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }

        .nav-title p {
            font-size: 13px;
            color: var(--text-light);
        }

        .nav-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .search-bar {
            position: relative;
            min-width: 250px;
        }

        .search-bar i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .search-bar input {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border-radius: 30px;
            border: 1px solid var(--border);
            background-color: var(--card);
            color: var(--text);
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .search-bar input:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        .search-bar input:focus + i {
            color: var(--primary-light);
            transform: translateY(-50%) scale(1.1);
        }

        .search-bar input::placeholder {
            color: var(--text-light);
        }

        /* Notification Bell */
        .notifications {
            position: relative;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--card);
            border-radius: 50%;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .notifications:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .notifications i {
            font-size: 18px;
            color: var(--text-light);
            transition: all 0.3s ease;
        }

        .notifications:hover i {
            color: var(--primary-light);
            animation: ring 0.5s ease;
        }

        @keyframes ring {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(-15deg); }
            75% { transform: rotate(10deg); }
            100% { transform: rotate(0deg); }
        }

        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: var(--danger);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        /* ✅ New Styles — Badge Unlock Animation */
.achievement-badge {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: gold;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    margin: 20px auto;
}

.badge-hidden {
    opacity: 0;
    transform: scale(0.5);
    transition: opacity 0.5s ease, transform 0.5s ease;
}

.badge-unlocked {
    opacity: 1;
    transform: scale(1);
}

/* ✅ Progress Section Wrapper (for consistency) */
.progress-section {
    padding: 2rem;
}

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Notification Popup */
        .notification-popup {
            position: fixed;
            top: 80px;
            right: 30px;
            width: 350px;
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1100;
            display: none;
            border: 1px solid var(--border);
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .notification-popup.active {
            display: block;
            transform: translateY(0);
            opacity: 1;
        }

        .notification-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notification-header h3 {
            margin: 0;
            font-size: 16px;
        }

        .notification-clear {
            background: none;
            border: none;
            color: var(--primary);
            cursor: pointer;
            font-size: 14px;
        }

        .notification-list {
            list-style: none;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            transition: background-color 0.3s;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item:hover {
            background-color: rgba(76, 175, 80, 0.1);
        }

        .notification-item.unread {
            background-color: rgba(76, 175, 80, 0.05);
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .notification-title i {
            color: var(--primary);
        }

        .notification-message {
            font-size: 14px;
            color: var(--text-light);
        }

        .notification-time {
            font-size: 12px;
            color: var(--text-light);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Logout Button */
        .logout-btn {
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--card);
            border-radius: 50%;
            cursor: pointer;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-left: 10px;
        }

        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            background-color: rgba(244, 67, 54, 0.1);
        }

        .logout-btn i {
            font-size: 18px;
            color: var(--danger);
            transition: all 0.3s ease;
        }

        .logout-btn:hover i {
            transform: scale(1.1);
        }

        /* Grid Layout */
        .dashboard-content {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 40px;
            align-items: start;
        }

        /* Stats Section with 3D card effect */
.stats-section {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-md);
}

.stat-card {
  background-color: var(--card);
  border-radius: var(--radius-lg);
  padding: var(--space-md);
  box-shadow: var(--shadow-md);
  display: flex;
  align-items: center;
  gap: var(--space-md);
  transition: all var(--transition-bounce);
  position: relative;
  overflow: hidden;
  z-index: var(--z-index-base);
}

.stat-card::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.3) 0%,
    rgba(255, 255, 255, 0) 100%
  );
  z-index: -1;
  opacity: 0;
  transition: opacity var(--transition-normal);
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-lg);
}

.stat-card:hover::before {
  opacity: 1;
}

.stat-icon {
  width: 50px;
  height: 50px;
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: var(--font-size-lg);
  color: white;
  flex-shrink: 0;
  transition: all var(--transition-bounce);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.stat-info h3 {
  font-size: var(--font-size-sm);
  color: var(--text-light);
  margin-bottom: var(--space-xs);
  font-weight: 500;
  transition: color var(--transition-normal);
}

.stat-info p {
  font-size: var(--font-size-xl);
  font-weight: 700;
  margin-bottom: var(--space-xs);
  color: var(--text);
  transition: color var(--transition-normal);
}

.trend {
  font-size: var(--font-size-xs);
  display: flex;
  align-items: center;
  gap: var(--space-xs);
  padding: var(--space-xs) var(--space-sm);
  border-radius: var(--radius-full);
  transition: all var(--transition-normal);
  font-weight: 600;
}

.trend.up {
  color: var(--success);
  background-color: rgba(76, 175, 80, 0.1);
}

.trend.down {
  color: var(--danger);
  background-color: rgba(244, 67, 54, 0.1);
}

.stat-card:hover .trend {
  transform: translateY(-3px);
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* Gradient backgrounds for each card type with hover effects */
.stat-card.temperature {
  --card-color: #ff9a9e;
}

.stat-card.humidity {
  --card-color: #a1c4fd;
}

.stat-card.light {
  --card-color: #ffecd2;
}

.stat-card.ph {
  --card-color: #84fab0;
}

.stat-card.transport {
  --card-color: #667eea;
}

.stat-card.food {
  --card-color: #8BC34A;
}

.stat-card.energy {
  --card-color: #FFC107;
}

.stat-card.uv-index {
  --card-color: #FF9800;
}

.stat-card.exposure {
  --card-color: #03A9F4;
}

.stat-card.level {
  --card-color: #4CAF50;
}

.stat-card:hover {
  background: linear-gradient(135deg, var(--card-color), color-mix(in srgb, var(--card-color) 80%, white));
  color: white;
}

.stat-card:hover .stat-info h3,
.stat-card:hover .stat-info p,
.stat-card:hover .trend {
  color: inherit !important;
}

.stat-card:hover .stat-icon {
  transform: rotate(15deg) scale(1.2);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
  background-color: rgba(255, 255, 255, 0.3) !important;
}

.stat-icon {
  background: linear-gradient(135deg, var(--card-color), color-mix(in srgb, var(--card-color) 80%, black));
}


        /* Right Section: Profile */
.profile-section {
    display: flex;
    flex-direction: column;
    gap: var(--space-xl);
}

.profile-box {
    background: var(--card);
    padding: var(--space-2xl) var(--space-xl);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: transform var(--transition-normal), box-shadow var(--transition-normal);
    border: 1px solid var(--border);
}

.profile-box:hover {
    transform: translateY(-5px);
    box-shadow: var(--shadow-xl);
}

.avatar-wrapper {
    position: relative;
    display: inline-block;
    margin: 0 auto;
}

.avatar {
    width: 90px;
    height: 90px;
    border-radius: var(--radius-full);
    background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-dark) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-md);
    border: 3px solid var(--card);
    transition: all var(--transition-bounce);
}

.avatar i {
    font-size: 60px;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.avatar-wrapper:hover .avatar {
    transform: scale(1.05);
    box-shadow: 0 8px 25px var(--primary-fade);
}

.achievement-badge {
    position: top;
    top: -5;
    left: -5;
    background: linear-gradient(180deg, var(--warning) 0%, var(--danger) 100%);
    color: rgb(223, 172, 8);
    border-radius: rgb(223, 172, 8);
    width: 30px;
    height: 30px;
    display: top;
    align-items: top;
    justify-content: top;
    font-size: 16px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    border: 2px solid var(--card);
    z-index: var(--z-index-above);
    animation: pulse 2s top;
}

@keyframes pulse {
    0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 165, 0, 0.7); }
    50% { transform: scale(1.1); box-shadow: 0 0 0 10px rgba(255, 165, 0, 0); }
    100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 165, 0, 0); }
}

.profile-content {
    margin-top: var(--space-lg);
    display: flex;
    flex-direction: column;
    align-items: center;
}

.username {
    font-size: var(--font-size-2xl);
    color: var(--text);
    font-weight: 600;
    margin-bottom: var(--space-xs);
    letter-spacing: -0.5px;
}

.rank {
    display: inline-block;
    background: var(--primary-fade);
    color: var(--primary-dark);
    padding: var(--space-xs) var(--space-sm);
    border-radius: var(--radius-full);
    font-size: var(--font-size-sm);
    font-weight: 600;
    margin-bottom: var(--space-md);
    border: 1px solid var(--primary-light);
}

.rank-progress {
    color: var(--text-light);
    font-size: var(--font-size-sm);
    margin-bottom: var(--space-sm);
    width: 100%;
}

.progress-container {
    width: 100%;
    max-width: 300px;
    margin: 0 auto;
}

.progress-bar {
    background-color: var(--border);
    border-radius: var(--radius-full);
    overflow: hidden;
    height: 8px;
    margin-bottom: var(--space-md);
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

.progress-fill {
    background: linear-gradient(90deg, var(--primary) 0%, var(--primary-light) 100%);
    height: 100%;
    transition: width 0.6s var(--transition-bounce);
    border-radius: var(--radius-full);
}

.contribution-card {
    background: var(--card);
    border-radius: var(--radius-xl);
    padding: var(--space-xl);
    box-shadow: var(--shadow-lg);
    text-align: center;
    border: 1px solid var(--border);
    transition: transform var(--transition-normal);
}

.contribution-card:hover {
    transform: translateY(-3px);
}

.contribution-card h4 {
    margin-bottom: var(--space-lg);
    color: var(--text);
    font-size: var(--font-size-lg);
    font-weight: 600;
}

.contribution-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(20px, 1fr));
    gap: 6px;
    justify-items: center;
    margin: 0 auto;
    max-width: 300px;
}

.contribution-cell {
    width: 20px;
    height: 20px;
    border-radius: var(--radius-sm);
    background-color: var(--sidebar);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.contribution-cell::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--primary);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.contribution-cell:hover {
    transform: scale(1.1);
}

.contribution-cell:hover::after {
    opacity: 0.3;
}

/* Dynamic coloring for contribution cells */
.contribution-cell[data-level="1"] { background-color: var(--primary-fade); }
.contribution-cell[data-level="2"] { background-color: var(--primary-light); }
.contribution-cell[data-level="3"] { background-color: var(--primary); }
.contribution-cell[data-level="4"] { background-color: var(--primary-dark); }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 999;
            padding-top: 80px;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--card);
            margin: auto;
            padding: 30px 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary);
        }

        .modal-content h2 {
            margin-bottom: 15px;
            color: var(--text);
        }

        .avatar-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .avatar-options img {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 2px solid var(--border);
            cursor: pointer;
            transition: 0.3s ease;
        }

        .avatar-options img:hover {
            border-color: var(--primary);
        }

        .save-btn {
            background-color: var(--primary);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s ease;
        }

        .save-btn:hover {
            background-color: var(--primary-dark);
        }

        /* Edit pencil icon inside rank-progress */
        .edit-profile i {
            cursor: pointer;
            margin-left: 8px;
            color: var(--primary-light);
            font-size: 16px;
        }

        .achievement-badge {
    position: absolute;
    top: -10px;
    left: 0;
    background-color: var(--primary-light);
    color: #fff;
    border-radius: 50%;
    padding: 6px;  /* Reduced size */
    font-size: 14px;  /* Smaller icon inside */
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.12);
    animation: badge-float 4s ease-in-out infinite alternate;
    z-index: 2;
}

@keyframes badge-float {
    0% { left: 0; }
    100% { left: 15px; }  /* Increased movement slightly */
}


        /* Charts */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background-color: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }

        .chart-card:nth-child(1) {
            animation-delay: 0.1s;
        }
        .chart-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Chart Header */
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .chart-actions {
            display: flex;
            gap: 10px;
        }

        .chart-actions button {
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .chart-actions button:hover {
            color: var(--primary-light);
            background-color: rgba(76, 175, 80, 0.1);
        }

        .chart-actions button.active {
            color: var(--primary-light);
            background-color: rgba(76, 175, 80, 0.1);
            font-weight: 500;
        }

        .chart-wrapper {
            position: relative;
            height: 250px;
            width: 100%;
        }

        /* Page Content Styles */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 15px 20px;
        }

        .page-header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-left: 10px;
        }

        .page-header .actions {
            display: flex;
            gap: 15px;
        }

        .page-content .card {
            background: rgba(var(--card-bg-rgb), 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            padding: 20px;
        }

        .page-content .card h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--text);
        }

        /* Analytics Page */
        #analytics-page .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        #analytics-page .metric-card {
            background-color: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: all 0.3s ease;
        }

        #analytics-page .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        #analytics-page .metric-card h3 {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 10px;
        }

        #analytics-page .metric-card .value {
            font-size: 24px;
            font-weight: 600;
            color: var(--primary);
        }

        #analytics-page .metric-card .change {
            font-size: 12px;
            margin-top: 5px;
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
        }

        #analytics-page .metric-card .change.positive {
            background-color: rgba(76, 175, 80, 0.1);
            color: var(--success);
        }

        #analytics-page .metric-card .change.negative {
            background-color: rgba(244, 67, 54, 0.1);
            color: var(--danger);
        }

        /* Carbon Page Specific Styles */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .log-form {
            display: grid;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            font-size: 14px;
            color: var(--text-light);
        }

        .form-group select, 
        .form-group input {
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--card);
            color: var(--text);
        }

        .stat-card.transport:hover {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            color: white;
        }

        .stat-card.food:hover {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: white;
        }

        .stat-card.energy:hover {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
        }

        .stat-icon.transport {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
        }

        .stat-icon.food {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }

        .stat-icon.energy {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-control {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--card);
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }

        .form-control:focus {
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        .btn-log-entry {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
            box-shadow: var(--shadow);
        }

        .btn-log-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(46, 125, 50, 0.3);
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
        }

        .btn-log-entry i {
            font-size: 16px;
            transition: transform 0.3s ease;
        }

        .btn-log-entry:hover i {
            transform: scale(1.1);
        }

        /* Export Data Button */
        .btn-export {
            background: linear-gradient(to right, #4CAF50, #8BC34A);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
            background: linear-gradient(to right, #8BC34A, #4CAF50);
        }

        /* Share Button - Updated Style */
        .share-container {
            position: relative;
            display: inline-block;
        }

        .share-btn {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .share-btn::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3) 0%,
                rgba(255, 255, 255, 0) 60%
            );
            transform: rotate(30deg);
            transition: all 0.3s ease;
        }

        .share-btn:hover::before {
            animation: shine 1.5s infinite;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 125, 50, 0.3);
            background: linear-gradient(135deg, #2E7D32, #4CAF50);
        }

        .share-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            background-color: var(--card);
            min-width: 200px;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 100;
            padding: 10px;
            border: 1px solid var(--border);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .share-container:hover .share-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .share-dropdown a {
            color: var(--text);
            padding: 8px 12px;
            text-decoration: none;
            display: block;
            border-radius: 4px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .share-dropdown a:hover {
            background-color: rgba(76, 175, 80, 0.1);
            transform: translateX(5px);
        }

        .share-dropdown a i {
            width: 20px;
            text-align: center;
            font-size: 16px;
        }

        .share-dropdown a .fab.fa-facebook-f { color: #3b5998; }
        .share-dropdown a .fab.fa-twitter { color: #1da1f2; }
        .share-dropdown a .fab.fa-linkedin-in { color: #0077b5; }
        .share-dropdown a .fas.fa-envelope { color: #d44638; }

        /* Export Dropdown */
        .export-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            background-color: var(--card);
            min-width: 200px;
            border-radius: 8px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            z-index: 100;
            padding: 10px;
            border: 1px solid var(--border);
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.3s ease;
        }

        .export-container:hover .export-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .export-dropdown a {
            color: var(--text);
            padding: 8px 12px;
            text-decoration: none;
            display: block;
            border-radius: 4px;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .export-dropdown a:hover {
            background-color: rgba(76, 175, 80, 0.1);
        }

        .export-dropdown a i {
            width: 20px;
            text-align: center;
        }

        /* Note Button */
        .btn-new-note {
            background: linear-gradient(to right, #FF9800, #FFC107);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .btn-new-note:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 152, 0, 0.3);
            background: linear-gradient(to right, #FFC107, #FF9800);
        }

        /* Note Modal */
        .note-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .note-modal-content {
            background-color: var(--card);
            margin: 5% auto;
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            transform: perspective(1000px) rotateX(5deg);
            transition: transform 0.3s ease;
        }

        .note-modal-content:hover {
            transform: perspective(1000px) rotateX(0deg);
        }

        .note-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .note-modal-header h2 {
            margin: 0;
            color: var(--text);
            font-size: 22px;
            font-weight: 600;
        }

        .note-modal-close {
            color: var(--text-light);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .note-modal-close:hover {
            color: var(--danger);
        }

        .note-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .note-form input,
        .note-form textarea {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--card);
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .note-form input {
            font-weight: 600;
        }

        .note-form textarea {
            min-height: 150px;
            resize: vertical;
        }

        .note-form input:focus,
        .note-form textarea:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        .attachment-options {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .attachment-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--sidebar);
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .attachment-btn:hover {
            background-color: var(--primary-light);
            color: white;
            transform: scale(1.1);
        }

        .note-form button {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .note-form button:hover {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
        }

        /* Vitamin D Page Specific Styles */
        .vitamin-controls {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .location-personalization {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .location-personalization {
                grid-template-columns: 1fr;
            }
        }

        /* Location Detection Section */
        .location-detection {
            margin-bottom: 12px;
        }

        .detection-options {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .detection-btn {
            flex: 1;
            padding: 14px 20px;
            border-radius: 8px;
            background: var(--card);
            border: 1px solid var(--border);
            color: var(--text-light);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 12px;
            font-weight: 600;
        }

        .detection-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        #auto-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 8px;
        }

        #auto-section p {
            margin: 0;
            color: var(--text-light);
            font-size: 14px;
            line-height: 1.5;
        }

        #get-location {
            width: auto; /* Remove full width */
            padding: 8px 24px; /* Tighter padding */
            border-radius: 8px;
            background: #4285F4; /* Google blue */
            border-color: #4285F4;
            color: white;
            border: 1px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 13px;
            display: inline-flex; /* Fits content width */
            margin: 0 auto; /* Center horizontally */
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #get-location:hover {
            background: #3367D6; /* Darker blue */
            border-color: #3367D6;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        #get-location i {
            font-size: 15px;
        }

        /* Manual Input Section */
        #manual-section {
            display: none;
            margin-top: 15px;
        }

        /* Personalization Section */
        .personalization-section {
            margin: 25px 0;
        }

         /* Vitamin D stat cards with hover effects */
        .stat-card.uv-index:hover {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
        }

        .stat-card.exposure:hover {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            color: white;
        }

        .stat-card.level:hover {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: white;
        }

        /* Form Elements */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background-color: var(--card);
            color: var(--text);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-light);
        }

        /* Results Cards */
        .vitamin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            margin-bottom: 10px;
        }

        .stat-info h3 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: var(--text-light);
        }

        .stat-info p {
            margin: 0;
            font-size: 24px;
            font-weight: 600;
            color: var(--text);
        }

        /* Progress & Badges Page */
        #progress-page .badges-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        #progress-page .badge-card {
            background-color: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: all 0.3s ease;
        }

        #progress-page .badge-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        #progress-page .badge-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
            color: white;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        #progress-page .badge-card h3 {
            font-size: 14px;
            margin-bottom: 5px;
        }

        #progress-page .badge-card p {
            font-size: 12px;
            color: var(--text-light);
        }

        #progress-page .progress-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        #progress-page .progress-item {
            background-color: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        #progress-page .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        #progress-page .progress-title {
            font-size: 16px;
            font-weight: 600;
        }

        #progress-page .progress-percent {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
        }

        #progress-page .progress-bar {
            height: 10px;
            background-color: var(--border);
            border-radius: 5px;
            overflow: hidden;
        }

        #progress-page .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            border-radius: 5px;
            transition: width 0.5s ease;
        }

        /* Articles & Notes Page */
        #articles-page .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        #articles-page .article-card {
            background-color: var(--card);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        #articles-page .article-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }

        #articles-page .article-image {
            height: 150px;
            background-size: cover;
            background-position: center;
        }

        #articles-page .article-content {
            padding: 20px;
        }

        #articles-page .article-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        #articles-page .article-excerpt {
            font-size: 14px;
            color: var(--text-light);
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        #articles-page .article-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-light);
        }

        #articles-page .notes-container {
            background-color: var(--card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        #articles-page .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        #articles-page .notes-title {
            font-size: 18px;
            font-weight: 600;
        }

        .add-note {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .add-note:hover {
            background-color: var(--primary-dark);
        }

        #articles-page .note {
            background-color: rgba(76, 175, 80, 0.1);
            border-left: 3px solid var(--primary);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 5px 5px 0;
        }

        #articles-page .note-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        #articles-page .note-content {
            font-size: 14px;
            color: var(--text-light);
        }

        /* Settings Page */
        #settings-page .settings-section {
            margin-bottom: 30px;
        }

        #settings-page .settings-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        #settings-page .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }

        #settings-page .setting-item:last-child {
            border-bottom: none;
        }

        #settings-page .setting-info h3 {
            font-size: 15px;
            margin-bottom: 5px;
        }

        #settings-page .setting-info p {
            font-size: 13px;
            color: var(--text-light);
        }

        /* Settings Toggle Switch */
        .settings-toggle {
            position: relative;
            display: inline-block;
            width: 58px;
            height: 30px;
        }

        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #F5C518;
            transition: .4s;
            border-radius: 34px;
        }

        .settings-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: #616161;
            transition: .4s;
            border-radius: 50%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);

        }

        input:checked + .settings-slider {
            background-color: var(--primary-light);
        }

        input:checked + .settings-slider:before {
            transform: translateX(30px);
            background-color: white;

        }

        /* EcoBot AI Assistant - Enhanced to match your design */
.ai-assistant {
    --ai-primary: var(--primary);
    --ai-primary-light: var(--primary-light);
    --ai-primary-dark: var(--primary-dark);
    --ai-text: var(--text);
    --ai-text-light: var(--text-light);
    --ai-bg: var(--card);
    --ai-border: var(--border);
    --ai-shadow: var(--shadow-md);
    --ai-radius: var(--radius-lg);
    position: fixed;
    bottom: var(--space-lg);
    right: var(--space-lg);
    z-index: var(--z-index-modal);
}

/* Floating Button */
.ai-btn {
    width: 60px;
    height: 60px;
    border-radius: var(--radius-full);
    background: var(--ai-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: var(--font-size-xl);
    cursor: pointer;
    border: none;
    outline: none;
    box-shadow: var(--ai-shadow);
    transition: all var(--transition-bounce);
    position: relative;
    z-index: var(--z-index-above);
}

.ai-btn:hover {
    transform: scale(1.1) rotate(10deg);
    background: var(--ai-primary-light);
    box-shadow: var(--shadow-lg);
}

.pulse-dot {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 12px;
    height: 12px;
    background: var(--danger);
    border-radius: var(--radius-full);
    border: 2px solid var(--ai-primary);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.2); opacity: 0.7; }
    100% { transform: scale(1); opacity: 1; }
}

/* Chat Container */
.ai-container {
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 350px;
    max-height: 500px;
    display: flex;
    flex-direction: column;
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    transition: all var(--transition-normal);
    overflow: hidden;
}

.ai-container.active {
    opacity: 1;
    transform: translateY(0);
    pointer-events: all;
}

/* Header */
.ai-header {
    background: linear-gradient(135deg, var(--ai-primary), var(--ai-primary-dark));
    color: white;
    padding: var(--space-md);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
}

.ai-title {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
}

.ai-title h3 {
    margin: 0;
    font-size: var(--font-size-lg);
    font-weight: 600;
}

.ai-title i {
    font-size: var(--font-size-lg);
}

.ai-status {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: var(--font-size-xs);
    margin-left: var(--space-sm);
    opacity: 0.8;
}

.status-dot {
    width: 8px;
    height: 8px;
    background: var(--success);
    border-radius: var(--radius-full);
    animation: status-pulse 1.5s infinite;
}

@keyframes status-pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

.ai-close {
    background: none;
    border: none;
    color: white;
    font-size: var(--font-size-xl);
    cursor: pointer;
    transition: transform var(--transition-fast);
}

.ai-close:hover {
    transform: rotate(90deg);
}

/* Messages Container */
.ai-messages {
    flex: 1;
    padding: var(--space-md);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
    background: var(--ai-bg);
}

.ai-message {
    max-width: 85%;
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--ai-radius);
    font-size: var(--font-size-sm);
    line-height: 1.5;
    animation: messageIn var(--transition-fast);
    position: relative;
    box-shadow: var(--shadow-sm);
}

@keyframes messageIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.ai-message.bot {
    align-self: flex-start;
    background: var(--sidebar);
    color: var(--ai-text);
    border-bottom-left-radius: var(--radius-sm);
}

.ai-message.bot::before {
    content: '';
    position: absolute;
    left: -8px;
    top: 12px;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-right: 8px solid var(--sidebar);
}

.ai-message.user {
    align-self: flex-end;
    background: linear-gradient(135deg, var(--ai-primary), var(--ai-primary-light));
    color: white;
    border-bottom-right-radius: var(--radius-sm);
}

.ai-message.user::before {
    content: '';
    position: absolute;
    right: -8px;
    top: 12px;
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-left: 8px solid var(--ai-primary);
}

.message-time {
    font-size: var(--font-size-xs);
    opacity: 0.7;
    margin-top: var(--space-xs);
    text-align: right;
}

/* Input Area */
.ai-input {
    background: var(--sidebar);
    border-top: 1px solid var(--ai-border);
    padding: var(--space-md);
}

.quick-actions {
    display: flex;
    gap: var(--space-xs);
    margin-bottom: var(--space-sm);
}

.quick-btn {
    flex: 1;
    background: var(--ai-primary-fade);
    color: var(--ai-primary-dark);
    border: 1px solid var(--ai-primary-light);
    border-radius: var(--radius-sm);
    padding: var(--space-xs);
    font-size: var(--font-size-xs);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    transition: all var(--transition-fast);
}

.quick-btn:hover {
    background: var(--ai-primary-light);
    color: white;
}

.input-wrapper {
    display: flex;
    gap: var(--space-sm);
}

.input-wrapper input {
    flex: 1;
    padding: var(--space-sm) var(--space-md);
    border-radius: var(--radius-full);
    border: 1px solid var(--ai-border);
    background: var(--ai-bg);
    color: var(--ai-text);
    font-size: var(--font-size-sm);
    transition: all var(--transition-fast);
}

.input-wrapper input:focus {
    border-color: var(--ai-primary);
    box-shadow: 0 0 0 2px var(--primary-fade);
    outline: none;
}

.input-wrapper button {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-full);
    background: var(--ai-primary);
    color: white;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all var(--transition-bounce);
}

.input-wrapper button:hover {
    background: var(--ai-primary-dark);
    transform: scale(1.1);
}

.voice-btn {
    background: var(--info) !important;
}

.voice-btn.listening {
    animation: pulse 1.5s infinite;
}

        /* Responsive */
        @media (max-width: 900px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
            .stats-section {
                grid-template-columns: 1fr;
            }
            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
                padding: 20px 0;
            }
            .sidebar .logo span,
            .sidebar .menu li a span {
                display: none;
            }
            /* Keep dark mode toggle visible in mobile */
            .dark-mode-toggle span {
                display: none;
            }
            .dark-mode-toggle {
                justify-content: center;
                padding: 15px 0;
            }
            .sidebar .logo {
                justify-content: center;
                padding: 0 10px;
            }
            .sidebar .menu li a {
                justify-content: center;
                padding: 12px 0;
            }
            .sidebar .menu li a i {
                margin-right: 0;
                font-size: 20px;
            }
            .main-content {
                margin-left: 80px;
                padding: 15px;
            }
            .navbar {
                flex-direction: column;
                align-items: flex-start;
            }
            .nav-actions {
                width: 100%;
                justify-content: space-between;
            }
            .search-bar {
                flex: 1;
                min-width: auto;
            }
            .chatbot-container {
                width: 300px;
                right: 15px;
            }
            .notification-popup {
                width: 300px;
                right: 15px;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                z-index: 1000;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
            }
            .menu-toggle {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1001;
                background-color: var(--card);
                border: 1px solid var(--border);
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }
            .menu-toggle:hover {
                transform: scale(1.1);
            }
            .menu-toggle i {
                font-size: 20px;
                color: var(--text);
                transition: all 0.3s ease;
            }
            .menu-toggle.active i {
                transform: rotate(90deg);
            }
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            .page-header .actions {
                width: 100%;
                justify-content: flex-end;
            }
            .chatbot-container {
                width: calc(100% - 30px);
                right: 15px;
                bottom: 90px;
            }
            .notification-popup {
                width: calc(100% - 30px);
                right: 15px;
            }
        }

        /* Fallback for browsers that don't support backdrop-filter */
        @supports not (backdrop-filter: blur(12px)) {
            .glass-card {
                background: var(--card);
            }
            .sidebar {
                background: var(--sidebar);
            }
            .navbar {
                background: var(--card);
            }

            .glass-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" opacity="0.04"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100" height="100" filter="url(%23noise)"/></svg>');
                border-radius: 12px;
                pointer-events: none;
            }
        }
    </style>
</head>
<body class="light-mode">
    <!-- Mobile Menu Toggle -->
    <div class="menu-toggle" id="menuToggle">
        <i class="fas fa-bars"></i>
    </div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-leaf"></i>
            </div>
            <span>EcoSphere</span>
        </div>
        <ul class="menu">
            <li class="active"><a href="#" data-page="dashboard-page"><i class="fas fa-home"></i> <span>Dashboard</span></a></li>
            <li><a href="#" data-page="analytics-page"><i class="fas fa-chart-line"></i> <span>Analytics</span></a></li>
            <li><a href="#" data-page="carbon-footprint-page"><i class="fas fa-cloud"></i> <span>Carbon Footprint</span></a></li>
            <li><a href="#" data-page="vitamin-d-page"><i class="fas fa-sun"></i> <span>Vitamin D</span></a></li>
            <li><a href="#" data-page="progress-page"><i class="fas fa-trophy"></i> <span>Progress</span></a></li>
            <li><a href="#" data-page="articles-page"><i class="fas fa-book"></i> <span>Articles</span></a></li>
            <li><a href="#" data-page="settings-page"><i class="fas fa-cog"></i> <span>Settings</span></a></li>
        </ul>
        <div class="dark-mode-toggle">
            <label class="toggle-switch">
                <input type="checkbox" id="darkModeToggle">
                <span class="slider round"></span>
            </label>
            <span>Dark Mode</span>
        </div>
    </div>

    <!-- Notification Popup (Moved outside main content to be global) -->
    <div class="notification-popup" id="notificationPopup">
        <div class="notification-header">
            <h3>Notifications</h3>
            <button class="notification-clear">Clear All</button>
        </div>
        <ul class="notification-list">
            <li class="notification-item unread">
                <div class="notification-title">
                    <i class="fas fa-leaf"></i> Eco Challenge Completed
                </div>
                <div class="notification-message">
                    You've completed the "Reduce Water Usage" challenge!
                </div>
                <div class="notification-time">
                    <i class="far fa-clock"></i> 2 hours ago
                </div>
            </li>
            <li class="notification-item">
                <div class="notification-title">
                    <i class="fas fa-chart-line"></i> Weekly Report
                </div>
                <div class="notification-message">
                    Your weekly carbon footprint report is ready to view.
                </div>
                <div class="notification-time">
                    <i class="far fa-clock"></i> 1 day ago
                </div>
            </li>
            <li class="notification-item">
                <div class="notification-title">
                    <i class="fas fa-trophy"></i> New Badge Earned
                </div>
                <div class="notification-message">
                    You've earned the "Energy Saver" badge for reducing electricity usage.
                </div>
                <div class="notification-time">
                    <i class="far fa-clock"></i> 3 days ago
                </div>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page-content">
            <!-- Navbar -->
            <div class="navbar">
                <div class="nav-title">
                    <h1>Dashboard Overview</h1>
                    <p>Last updated: Just now</p>
                </div>
                <div class="nav-actions">
                    <div class="notifications" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search...">
                    </div>
                    <div class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </div>
            </div>

            <!-- Main Dashboard Content -->
            <div class="dashboard-content">
                <!-- Left Column: Stats Cards -->
                <div class="stats-section">
                    <div class="stat-card temperature">
                        <div class="stat-icon temperature">
                            <i class="fas fa-thermometer-half"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Temperature</h3>
                            <p>24.5°C <span class="trend up"><i class="fas fa-arrow-up"></i> 0.3°C</span></p>
                        </div>
                    </div>

                    <div class="stat-card humidity">
                        <div class="stat-icon humidity">
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Humidity</h3>
                            <p>68% <span class="trend down"><i class="fas fa-arrow-down"></i> 2%</span></p>
                        </div>
                    </div>

                    <div class="stat-card light">
                        <div class="stat-icon light">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Light</h3>
                            <p>Optimal <span class="trend up"><i class="fas fa-check"></i> Stable</span></p>
                        </div>
                    </div>

                    <div class="stat-card ph">
                        <div class="stat-icon ph">
                            <i class="fas fa-flask"></i>
                        </div>
                        <div class="stat-info">
                            <h3>pH Level</h3>
                            <p>7.2 <span class="trend up"><i class="fas fa-check"></i> Balanced</span></p>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Profile Section -->
<div class="profile-section">
  <div class="profile-box">
    <div class="avatar-wrapper">
      <div class="achievement-badge badge-hidden" title="Rank Badge">
        <i class="fas fa-medal"></i>
      </div>
      <div class="avatar">
        <i class="fas fa-user-circle"></i>
      </div>
    </div>
    <h3 class="username">Loading...</h3>
    <p class="rank">Rank: Loading...</p>
    <p class="rank-progress">
      Progress: 0 / 100
      <span class="edit-profile" title="Edit Profile">
        <i class="fas fa-pencil-alt"></i>
      </span>
    </p>
    <div class="progress-bar">
      <div class="progress-fill" style="width: 0%;"></div>
    </div>
  </div>

<!-- Auto-sync profile info script -->
<script>
fetch('/api/auth/me')
  .then(res => res.json())
  .then(user => {
    document.querySelector('.username').textContent = user.name;
    document.querySelector('.rank').textContent = 'Rank: ' + (user.rank || '1');
    document.querySelector('.progress-fill').style.width = (user.progress || 0) + '%';
    document.querySelector('.rank-progress').innerHTML =
      'Progress: ' + (user.progress || 0) + ' / 100 <span class="edit-profile"><i class="fas fa-pencil-alt"></i></span>';

    if (user.rank >= 1) {
      document.querySelector('.achievement-badge').classList.add('badge-unlocked');
      document.querySelector('.achievement-badge').classList.remove('badge-hidden');
    }
  });
</script>

                    <div class="contribution-card">
                        <h4>Journey Flow</h4>
                        <div class="contribution-grid">
                            <div title="Planted Trees"></div>
                            <div title="Reduced Emissions"></div>
                            <div title="Saved Energy"></div>
                            <div title="Clean-Up Drive"></div>
                            <div title="Eco Challenge"></div>
                            <div></div><div></div><div></div><div></div><div></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="profileModal" class="modal">
                <div class="modal-content">
                    <span class="close">&times;</span>
                    <h2>Edit Profile</h2>
                    <label for="username">Name:</label>
                    <input type="text" id="username" value="John Doe">
                    
                    <h3>Select Avatar</h3>
                    <div class="avatar-options">
                        <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Explorer_Male_1" alt="Avatar 1">
                        <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Hero_Male_2" alt="Avatar 2">
                        <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Guardian_Male_3" alt="Avatar 3">
                        <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Nature_Female_1" alt="Avatar 4">
                        <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Voyager_Female_2" alt="Avatar 5">
                        <img src="https://api.dicebear.com/7.x/adventurer/svg?seed=Healer_Female_3" alt="Avatar 6">
                    </div>
                    <button class="save-btn">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Analytics Page -->
        <div id="analytics-page" class="page-content">
            <div class="page-header">
                <h1>Analytics</h1>
                <div class="actions">
                    <div class="export-container">
                        <button class="btn-export" id="exportDataBtn">
                            <i class="fas fa-file-export"></i> Export Data
                        </button>
                        <div class="export-dropdown">
                            <a href="#" data-type="csv"><i class="fas fa-file-csv"></i> Export as CSV</a>
                            <a href="#" data-type="pdf"><i class="fas fa-file-pdf"></i> Export as PDF</a>
                            <a href="#" data-type="docx"><i class="fas fa-file-word"></i> Export as DOCX</a>
                        </div>
                    </div>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search...">
                    </div>
                    <div class="notifications" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>
                    <div class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </div>
            </div>

            <div class="metrics">
                <div class="metric-card">
                    <h3>Avg. Temperature</h3>
                    <div class="value">24.2°C</div>
                    <div class="change positive">+0.5°C <i class="fas fa-arrow-up"></i></div>
                </div>
                <div class="metric-card">
                    <h3>Avg. Humidity</h3>
                    <div class="value">67%</div>
                    <div class="change negative">-2% <i class="fas fa-arrow-down"></i></div>
                </div>
                <div class="metric-card">
                    <h3>Light Hours</h3>
                    <div class="value">14h</div>
                    <div class="change positive">+1h <i class="fas fa-arrow-up"></i></div>
                </div>
                <div class="metric-card">
                    <h3>Water Changes</h3>
                    <div class="value">3</div>
                    <div class="change positive">+1 <i class="fas fa-arrow-up"></i></div>
                </div>
            </div>

            <!-- Added Charts Container -->
            <div class="charts-container">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Temperature Trends</h3>
                        <div class="chart-actions">
                            <button class="timeframe-btn active" data-timeframe="day">Day</button>
                            <button class="timeframe-btn" data-timeframe="week">Week</button>
                            <button class="timeframe-btn" data-timeframe="month">Month</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="temperatureChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>pH Level History</h3>
                        <div class="chart-actions">
                            <button class="timeframe-btn active" data-timeframe="day">Day</button>
                            <button class="timeframe-btn" data-timeframe="week">Week</button>
                            <button class="timeframe-btn" data-timeframe="month">Month</button>
                        </div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="phChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Environmental Trends</h2>
                <div class="chart-wrapper">
                    <canvas id="analyticsChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Carbon Footprint Page -->
        <div id="carbon-footprint-page" class="page-content">
            <div class="page-header">
                <h1>Carbon Footprint Tracker</h1>
                <div class="actions">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search...">
                    </div>
                    <div class="notifications" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>
                    <div class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card transport">
                    <div class="stat-icon transport">
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Transport</h3>
                        <p id="transport-co2">0 kg</p>
                        <span class="trend up"><i class="fas fa-arrow-up"></i> Daily</span>
                    </div>
                </div>
                <div class="stat-card food">
                    <div class="stat-icon food">
                        <i class="fas fa-utensils"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Food</h3>
                        <p id="food-co2">0 kg</p>
                        <span class="trend down"><i class="fas fa-arrow-down"></i> Weekly</span>
                    </div>
                </div>
                <div class="stat-card energy">
                    <div class="stat-icon energy">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="stat-info">
                        <h3>Energy</h3>
                        <p id="energy-co2">0 kWh</p>
                        <span class="trend up"><i class="fas fa-chart-line"></i> Monthly</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Daily Carbon Log</h2>
                <div class="log-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-tags"></i> Category</label>
                            <select id="category-select" class="form-control">
                                <option value="transport">🚗 Transport</option>
                                <option value="food">🍔 Food</option>
                                <option value="energy">⚡ Energy</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row" id="dynamic-inputs">
                        <!-- Dynamic inputs will appear here -->
                    </div>
                    
                    <button class="btn-log-entry" id="log-entry">
                        <i class="fas fa-calculator"></i> Calculate CO₂ Footprint
                    </button>
                </div>
            </div>
            <div class="card">
                <h2>Real-time CO₂ Impact</h2>
                <div class="chart-wrapper">
                    <canvas id="co2Chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Vitamin D Estimator Page -->
        <div id="vitamin-d-page" class="page-content">
            <div class="page-header">
                <h1>Vitamin D Estimator</h1>
                <div class="actions">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search...">
                    </div>
                    <div class="notifications" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>
                    <div class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </div>
            </div>

            <div class="vitamin-controls">
                <!-- Location and Personalization Grid -->
                <div class="location-personalization">
                    <!-- Location Section -->
                    <div class="card">
                        <h2>Location Detection</h2>
                        <div class="detection-options">
                            <button id="auto-detect" class="detection-btn active">
                                <i class="fas fa-location-arrow"></i> Auto Detect
                            </button>
                            <button id="manual-input" class="detection-btn">
                                <i class="fas fa-map-marker-alt"></i> Manual Input
                            </button>
                        </div>

                        <div class="location-inputs">
                            <!-- Auto-detect will show this -->
                            <div id="auto-section" class="input-section">
                                <p>We'll use your device's location to get accurate UV data</p>
                                <button id="get-location" class="btn-primary">
                                    <i class="fas fa-crosshairs"></i> Detect My Location
                                </button>
                            </div>

                            <!-- Manual input will show this -->
                            <div id="manual-section" class="input-section" style="display:none">
                                <div class="form-row">
                                    <div class="form-group country-select">
                                        <label><i class="fas fa-globe"></i> Country</label>
                                        <select id="country-select" class="form-control">
                                            <option value="">Select Country</option>
                                            <!-- Options will be populated by JS -->
                                        </select>
                                    </div>
                                    <div class="form-group city-select">
                                        <label><i class="fas fa-city"></i> City</label>
                                        <select id="city-select" class="form-control" disabled>
                                            <option value="">Select City</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Personalization Section -->
                    <div class="card">
                        <h2>Personalization</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label><i class="fas fa-user"></i> Skin Type</label>
                                <select id="skin-type" class="form-control">
                                    <option value="1">Type I (Very Fair)</option>
                                    <option value="2">Type II (Fair)</option>
                                    <option value="3">Type III (Medium)</option>
                                    <option value="4">Type IV (Olive)</option>
                                    <option value="5">Type V (Brown)</option>
                                    <option value="6">Type VI (Dark)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label><i class="fas fa-clock"></i> Exposure (minutes)</label>
                                <input type="number" id="exposure-time" class="form-control" min="1" max="240" value="15">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div class="card results-card">
                    <h2>Your Vitamin D Analysis</h2>
                    <div class="vitamin-stats">
                        <div class="stat-card uv-index">
                            <div class="stat-icon uv-index" style="background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);">
                                <i class="fas fa-sun"></i>
                            </div>
                            <div class="stat-info">
                                <h3>Current UV Index</h3>
                                <p id="current-uv">--</p>
                            </div>
                        </div>
                        <div class="stat-card exposure">
                            <div class="stat-icon exposure" style="background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <h3>Recommended Exposure</h3>
                                <p id="recommended-time">-- min</p>
                            </div>
                        </div>
                        <div class="stat-card level">
                            <div class="stat-icon level" style="background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-info">
                                <h3>Your Level</h3>
                                <p id="vitamin-level">--</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-wrapper">
                        <canvas id="vitaminChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

       <!-- Updated Progress & Badges Page (Final Version) -->
<div id="progress-page" class="page-content">
    <div class="page-header">
        <h1>Progress & Badges</h1>
        <div class="actions">
            <div class="share-container">
                <button class="share-btn">
                    <i class="fas fa-share-alt"></i> Share Progress
                </button>
                <div class="share-dropdown">
                    <a href="#"><i class="fab fa-facebook-f"></i> Facebook</a>
                    <a href="#"><i class="fab fa-twitter"></i> Twitter</a>
                    <a href="#"><i class="fab fa-linkedin-in"></i> LinkedIn</a>
                    <a href="#"><i class="fas fa-envelope"></i> Email</a>
                </div>
            </div>
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search...">
            </div>
            <div class="notifications" id="notificationsBtn">
                <i class="fas fa-bell"></i>
                <span class="badge">3</span>
            </div>
            <div class="logout-btn" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
            </div>
        </div>
    </div>

    <!-- Achievements Section -->
    <div class="card">
        <h2>Your Achievements</h2>
        <div class="badges-container">
            <!-- Loop badges dynamically later if needed -->
            <div class="badge-card">
                <div class="badge-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <h3>Rank 1: Eco Initiator</h3>
                <p>Quick start badge</p>
            </div>
            <div class="badge-card locked">
                <div class="badge-icon">
                    <i class="fas fa-lock"></i>
                </div>
                <h3>Rank 2: Green Learner</h3>
                <p>Unlock after first rank</p>
            </div>
            <!-- You can add more badges for Rank 3 to Rank 10 similarly -->
        </div>
    </div>

    <!-- Progress Section -->
    <div class="card">
        <h2>Your Progress</h2>
        <div class="progress-container">
            <div class="progress-item">
                <div class="progress-header">
                    <div class="progress-title">Current Rank Progress</div>
                    <div class="progress-percent">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
                <div class="achievement-badge badge-hidden" id="rankBadge">
                    <i class="fas fa-medal"></i>
                </div>
            </div>

            <!-- Example Additional Progress Areas -->
            <div class="progress-item">
                <div class="progress-header">
                    <div class="progress-title">Eco Habits</div>
                    <div class="progress-percent">0%</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Badge Unlock Animation Script Example (Ready for Later Integration) -->
<script>
function unlockRankBadge() {
    const badge = document.getElementById('rankBadge');
    badge.classList.remove('badge-hidden');
    badge.classList.add('badge-unlocked');
}

// Auto-sync profile info from backend
fetch('/api/auth/me')
  .then(res => res.json())
  .then(user => {
    document.querySelector('.username').textContent = user.name;
    document.querySelector('.rank').textContent = 'Rank: ' + (user.rank || '1');
    document.querySelector('.progress-fill').style.width = (user.progress || 0) + '%';
    document.querySelector('.rank-progress').innerHTML =
      'Progress: ' + (user.progress || 0) + ' / 100 <span class="edit-profile"><i class="fas fa-pencil-alt"></i></span>';

    if (user.rank >= 1) {
      document.querySelector('.achievement-badge').classList.add('badge-unlocked');
      document.querySelector('.achievement-badge').classList.remove('badge-hidden');
    }
  });
</script>


        <!-- Articles & Notes Page -->
        <div id="articles-page" class="page-content">
            <div class="page-header">
                <h1>Articles & Notes</h1>
                <div class="actions">
                    <button class="btn-new-note" id="newNoteBtn">
                        <i class="fas fa-plus"></i> New Note
                    </button>
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search...">
                    </div>
                    <div class="notifications" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>
                    <div class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>Featured Articles</h2>
                <div class="articles-grid">
                    <div class="article-card">
                        <div class="article-image" style="background-image: url('https://images.unsplash.com/photo-1466611653911-95081537e5b7?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60');"></div>
                        <div class="article-content">
                            <h3 class="article-title">10 Ways to Reduce Your Carbon Footprint</h3>
                            <p class="article-excerpt">Simple changes you can make today to significantly reduce your environmental impact and live more sustainably.</p>
                            <div class="article-meta">
                                <span><i class="far fa-clock"></i> 5 min read</span>
                                <span><i class="far fa-calendar-alt"></i> May 15, 2023</span>
                            </div>
                        </div>
                    </div>
                    <div class="article-card">
                        <div class="article-image" style="background-image: url('https://images.unsplash.com/photo-1508514177221-188b1cf16e9d?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60');"></div>
                        <div class="article-content">
                            <h3 class="article-title">The Science of Hydroponics</h3>
                            <p class="article-excerpt">How soil-less gardening can revolutionize food production and reduce water usage by up to 90% compared to traditional farming.</p>
                            <div class="article-meta">
                                <span><i class="far fa-clock"></i> 8 min read</span>
                                <span><i class="far fa-calendar-alt"></i> April 28, 2023</span>
                            </div>
                        </div>
                    </div>
                    <div class="article-card">
                        <div class="article-image" style="background-image: url('https://images.unsplash.com/photo-1488197047962-b48492212cda?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60');"></div>
                        <div class="article-content">
                            <h3 class="article-title">Understanding Your Vitamin D Needs</h3>
                            <p class="article-excerpt">Learn how much sunlight you really need for optimal vitamin D production based on your skin type and location.</p>
                            <div class="article-meta">
                                <span><i class="far fa-clock"></i> 6 min read</span>
                                <span><i class="far fa-calendar-alt"></i> April 10, 2023</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="notes-header">
                    <h2>Your Notes</h2>
                    <button class="add-note" id="addNoteBtn">
                        <i class="fas fa-plus"></i> Add Note
                    </button>
                </div>
                <div class="note">
                    <h3 class="note-title">Water Quality Observations</h3>
                    <p class="note-content">pH levels have been stable at 7.2 for the past week. Need to check ammonia levels tomorrow morning.</p>
                </div>
                <div class="note">
                    <h3 class="note-title">Light Schedule Changes</h3>
                    <p class="note-content">Increased grow light duration by 30 minutes to promote faster plant growth.</p>
                </div>
                <div class="note">
                    <h3 class="note-title">Carbon Offset Ideas</h3>
                    <p class="note-content">Research local tree planting initiatives to offset estimated 4.2 tons of annual CO₂ emissions.</p>
                </div>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page-content">
            <div class="page-header">
                <h1>Settings</h1>
                <div class="actions">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search...">
                    </div>
                    <div class="notifications" id="notificationsBtn">
                        <i class="fas fa-bell"></i>
                        <span class="badge">3</span>
                    </div>
                    <div class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h2>System Settings</h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Automatic Updates</h3>
                        <p>Keep system up to date</p>
                    </div>
                    <label class="settings-toggle">
                        <input type="checkbox" checked>
                        <span class="settings-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Data Backup</h3>
                        <p>Daily backup to cloud</p>
                    </div>
                    <label class="settings-toggle">
                        <input type="checkbox" checked>
                        <span class="settings-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Maintenance Mode</h3>
                        <p>Temporarily disable system</p>
                    </div>
                    <label class="settings-toggle">
                        <input type="checkbox">
                        <span class="settings-slider"></span>
                    </label>
                </div>
            </div>

            <div class="settings-section">
                <h2>Notification Settings</h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Email Alerts</h3>
                        <p>Receive email notifications</p>
                    </div>
                    <label class="settings-toggle">
                        <input type="checkbox" checked>
                        <span class="settings-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>Push Notifications</h3>
                        <p>Mobile app alerts</p>
                    </div>
                    <label class="settings-toggle">
                        <input type="checkbox" checked>
                        <span class="settings-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h3>SMS Alerts</h3>
                        <p>Critical alerts via SMS</p>
                    </div>
                    <label class="settings-toggle">
                        <input type="checkbox">
                        <span class="settings-slider"></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- EcoBot AI Assistant -->
    <div class="ai-assistant">
        <!-- Floating Button -->
        <button class="ai-btn glass-card" id="aiAssistantBtn">
            <i class="fas fa-robot"></i>
            <span class="pulse-dot"></span>
        </button>

        <!-- Chat Container -->
        <div class="ai-container glass-card" id="aiAssistantContainer">
            <!-- Header -->
            <div class="ai-header">
                <div class="ai-title">
                    <i class="fas fa-leaf"></i>
                    <h3>EcoBot Assistant</h3>
                    <div class="ai-status">
                        <span class="status-dot"></span>
                        <span>Online</span>
                    </div>
                </div>
                <button class="ai-close" id="aiAssistantClose">&times;</button>
            </div>

            <!-- Message Container -->
            <div class="ai-messages" id="aiMessages">
                <!-- Initial message will be inserted here by JS -->
            </div>

            <!-- Input Area -->
            <div class="ai-input">
                <div class="quick-actions">
                    <button class="quick-btn" data-action="footprint">
                        <i class="fas fa-shoe-prints"></i> Footprint
                    </button>
                    <button class="quick-btn" data-action="vitaminD">
                        <i class="fas fa-sun"></i> Vitamin D
                    </button>
                    <button class="quick-btn" data-action="tips">
                        <i class="fas fa-lightbulb"></i> Eco Tips
                    </button>
                </div>
                <div class="input-wrapper">
                    <input type="text" id="aiInput" placeholder="Ask about sustainability...">
                    <button id="aiSend"><i class="fas fa-paper-plane"></i></button>
                    <button id="aiVoice" class="voice-btn"><i class="fas fa-microphone"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- Note Modal -->
    <div id="noteModal" class="note-modal">
        <div class="note-modal-content">
            <div class="note-modal-header">
                <h2>Create New Note</h2>
                <span class="note-modal-close">&times;</span>
            </div>
            <form class="note-form">
                <input type="text" placeholder="Note Title" required>
                <textarea placeholder="Write your note here..." required></textarea>
                
                <div class="attachment-options">
                    <div class="attachment-btn" title="Add Image">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="attachment-btn" title="Add File">
                        <i class="fas fa-paperclip"></i>
                    </div>
                    <div class="attachment-btn" title="Add Location">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                </div>
                
                <button type="submit">Save Note</button>
            </form>
        </div>
    </div>
<script>
        // Dark Mode Toggle with smooth transition
        const darkModeToggle = document.getElementById('darkModeToggle');
        darkModeToggle.addEventListener('change', () => {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', darkModeToggle.checked);
            
            // Add transition class for smooth color changes
            document.body.classList.add('color-transition');
            setTimeout(() => {
                document.body.classList.remove('color-transition');
            }, 500);
        });

        // Check for saved dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            darkModeToggle.checked = true;
            document.body.classList.add('dark-mode');
        }

        // Mobile Menu Toggle with animation
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        
        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('active');
            menuToggle.classList.toggle('active');
        });

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 576 && !sidebar.contains(e.target) && !menuToggle.contains(e.target)) {
                sidebar.classList.remove('active');
                menuToggle.classList.remove('active');
            }
        });

        // Page Navigation
        const menuLinks = document.querySelectorAll('.menu li a');
        const pageContents = document.querySelectorAll('.page-content');
        
        menuLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Get the target page ID
                const targetPage = this.getAttribute('data-page');
                
                // Hide all pages
                pageContents.forEach(page => {
                    page.style.display = 'none';
                });
                
                // Show the target page
                document.getElementById(targetPage).style.display = 'block';
                
                // Update active menu item
                menuLinks.forEach(item => {
                    item.parentElement.classList.remove('active');
                });
                this.parentElement.classList.add('active');
                
                // Close sidebar on mobile
                if (window.innerWidth <= 576) {
                    sidebar.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        });

        // Notification System - Global functionality
        const notificationPopup = document.getElementById('notificationPopup');
        const notificationBadge = document.querySelectorAll('.badge');
        const notificationItems = document.querySelectorAll('.notification-item');
        
        // Initialize notification state
        let notifications = JSON.parse(localStorage.getItem('notifications')) || [
            {
                title: "Eco Challenge Completed",
                message: "You've completed the 'Reduce Water Usage' challenge!",
                time: "2 hours ago",
                read: false
            },
            {
                title: "Weekly Report",
                message: "Your weekly carbon footprint report is ready to view.",
                time: "1 day ago",
                read: true
            },
            {
                title: "New Badge Earned",
                message: "You've earned the 'Energy Saver' badge for reducing electricity usage.",
                time: "3 days ago",
                read: true
            }
        ];
        
        // Update notification count
        function updateNotificationCount() {
            const unreadCount = notifications.filter(n => !n.read).length;
            notificationBadge.forEach(badge => {
                badge.textContent = unreadCount;
                badge.style.display = unreadCount > 0 ? 'flex' : 'none';
            });
        }
        
        // Display notifications in popup
        function displayNotifications() {
            const notificationList = document.querySelector('.notification-list');
            notificationList.innerHTML = '';
            
            if (notifications.length === 0) {
                notificationList.innerHTML = '<li class="notification-item"><div class="notification-message">No notifications</div></li>';
                return;
            }
            
            notifications.forEach((notification, index) => {
                const item = document.createElement('li');
                item.className = `notification-item ${notification.read ? '' : 'unread'}`;
                item.innerHTML = `
                    <div class="notification-title">
                        <i class="fas fa-leaf"></i> ${notification.title}
                    </div>
                    <div class="notification-message">
                        ${notification.message}
                    </div>
                    <div class="notification-time">
                        <i class="far fa-clock"></i> ${notification.time}
                    </div>
                `;
                
                // Mark as read when clicked
                item.addEventListener('click', () => {
                    if (!notification.read) {
                        notification.read = true;
                        notifications[index].read = true;
                        localStorage.setItem('notifications', JSON.stringify(notifications));
                        item.classList.remove('unread');
                        updateNotificationCount();
                    }
                });
                
                notificationList.appendChild(item);
            });
        }
        
        // Toggle notification popup
        document.querySelectorAll('#notificationsBtn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.stopPropagation();
                notificationPopup.classList.toggle('active');
                displayNotifications();
                
                // Mark all as read when opened
                notifications = notifications.map(n => ({ ...n, read: true }));
                localStorage.setItem('notifications', JSON.stringify(notifications));
                updateNotificationCount();
            });
        });
        
        // Close notification popup when clicking outside
        document.addEventListener('click', function() {
            notificationPopup.classList.remove('active');
        });
        
        // Prevent popup from closing when clicking inside it
        notificationPopup.addEventListener('click', function(e) {
            e.stopPropagation();
        });
        
        // Clear all notifications
        document.querySelector('.notification-clear').addEventListener('click', function() {
            notifications = [];
            localStorage.setItem('notifications', JSON.stringify(notifications));
            document.querySelector('.notification-list').innerHTML = '<li class="notification-item"><div class="notification-message">No notifications</div></li>';
            updateNotificationCount();
        });
        
        // Initialize notification count on page load
        updateNotificationCount();

        // Logout Button
        document.getElementById('logoutBtn').addEventListener('click', async function () {
        await fetch('/api/auth/logout', { method: 'POST' });
         window.location.href = '/';
        });


        // Export Data Button with dropdown
        const exportDataBtn = document.getElementById('exportDataBtn');
        const exportDropdown = document.querySelector('.export-dropdown');
        
        exportDataBtn.addEventListener('click', function(e) {
            e.stopPropagation();
            exportDropdown.classList.toggle('active');
        });
        
        // Close export dropdown when clicking outside
        document.addEventListener('click', function() {
            exportDropdown.classList.remove('active');
        });
        
        // Export options
        document.querySelectorAll('.export-dropdown a').forEach(option => {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                const type = this.getAttribute('data-type');
                exportData(type);
                exportDropdown.classList.remove('active');
            });
        });
        
        function exportData(type) {
            let content, filename, mimeType;
            
            if (type === 'csv') {
                content = "data:text/csv;charset=utf-8,Metric,Value,Change\n" +
                    "Avg. Temperature,24.2°C,+0.5°C\n" +
                    "Avg. Humidity,67%,-2%\n" +
                    "Light Hours,14h,+1h\n" +
                    "Water Changes,3,+1";
                filename = "ecosphere_analytics.csv";
                mimeType = "text/csv";
            } else if (type === 'pdf') {
                // In a real app, you would generate a PDF using a library like jsPDF
                alert("PDF export would be generated here in a real application");
                return;
            } else if (type === 'docx') {
                // In a real app, you would generate a DOCX using a library like docx
                alert("DOCX export would be generated here in a real application");
                return;
            }
            
            // Create a download link
            const encodedUri = encodeURI(content);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", filename);
            document.body.appendChild(link);
            
            // Trigger the download
            link.click();
            document.body.removeChild(link);
            
            // Show success message
            alert(`Data exported successfully as ${type.toUpperCase()} file!`);
        }

        // Chart Data Storage
        const chartData = {
            temperatureChart: {
                day: {
                    labels: ['6AM', '9AM', '12PM', '3PM', '6PM', '9PM', '12AM'],
                    data: [22, 23, 24.5, 25, 24, 23, 22]
                },
                week: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    data: [21, 22, 23.5, 24, 23.5, 23, 22]
                },
                month: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    data: [22.5, 23.2, 23.8, 22.9]
                }
            },
            phChart: {
                day: {
                    labels: ['6AM', '9AM', '12PM', '3PM', '6PM', '9PM', '12AM'],
                    data: [7.0, 7.1, 7.2, 7.1, 7.0, 7.1, 7.0]
                },
                week: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    data: [6.9, 7.0, 7.2, 7.1, 7.0, 6.9, 7.0]
                },
                month: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    data: [7.1, 7.0, 6.9, 7.0]
                }
            }
        };

        // Initialize Charts
        const tempCtx = document.getElementById('temperatureChart').getContext('2d');
        const tempChart = new Chart(tempCtx, {
            type: 'line',
            data: {
                labels: chartData.temperatureChart.day.labels,
                datasets: [{
                    label: 'Temperature (°C)',
                    data: chartData.temperatureChart.day.data,
                    borderColor: '#ff9a9e',
                    backgroundColor: 'rgba(255, 154, 158, 0.1)',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: false, min: 20, max: 26, grid: { color: 'rgba(0, 0, 0, 0.05)' } },
                    x: { grid: { display: false } }
                },
                animation: { duration: 1000, easing: 'easeOutQuart' }
            }
        });

        const phCtx = document.getElementById('phChart').getContext('2d');
        const phChart = new Chart(phCtx, {
            type: 'line',
            data: {
                labels: chartData.phChart.day.labels,
                datasets: [{
                    label: 'pH Level',
                    data: chartData.phChart.day.data,
                    borderColor: '#84fab0',
                    backgroundColor: 'rgba(132, 250, 176, 0.1)',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: false, min: 6.5, max: 7.5, grid: { color: 'rgba(0, 0, 0, 0.05)' } },
                    x: { grid: { display: false } }
                },
                animation: { duration: 1000, easing: 'easeOutQuart' }
            }
        });

        // Analytics Chart
        const analyticsCtx = document.getElementById('analyticsChart').getContext('2d');
        const analyticsChart = new Chart(analyticsCtx, {
            type: 'bar',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [
                    {
                        label: 'Temperature',
                        data: [22, 23, 24, 25, 26, 27],
                        backgroundColor: 'rgba(255, 154, 158, 0.7)',
                        borderColor: '#ff9a9e',
                        borderWidth: 1
                    },
                    {
                        label: 'Humidity',
                        data: [70, 68, 65, 67, 66, 64],
                        backgroundColor: 'rgba(161, 196, 253, 0.7)',
                        borderColor: '#a1c4fd',
                        borderWidth: 1
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { position: 'top' } },
                scales: {
                    y: { beginAtZero: false, grid: { color: 'rgba(0, 0, 0, 0.05)' } },
                    x: { grid: { display: false } }
                }
            }
        });

        // Timeframe Switching Functionality
        document.querySelectorAll('.timeframe-btn').forEach(button => {
            button.addEventListener('click', function() {
                const chartCard = this.closest('.chart-card');
                const chartId = chartCard.querySelector('canvas').id.replace('Chart', '').toLowerCase() + 'Chart';
                const timeframe = this.dataset.timeframe;
                
                // Update active button state
                chartCard.querySelectorAll('.timeframe-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // Update the chart
                updateChartTimeframe(chartId, timeframe);
            });
        });

        function updateChartTimeframe(chartId, timeframe) {
            const chart = chartId === 'temperatureChart' ? tempChart : phChart;
            const data = chartData[chartId][timeframe];
            
            chart.data.labels = data.labels;
            chart.data.datasets[0].data = data.data;
            
            // Adjust Y-axis range for month view
            if (timeframe === 'month') {
                chart.options.scales.y.min = chartId === 'temperatureChart' ? 20 : 6.5;
                chart.options.scales.y.max = chartId === 'temperatureChart' ? 26 : 7.5;
            }
            
            chart.update();
        }

        // Carbon Footprint Chart
        const co2Ctx = document.getElementById('co2Chart').getContext('2d');
        const co2Chart = new Chart(co2Ctx, {
            type: 'line',
            data: {
                labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                datasets: [
                    {
                        label: 'Transport CO₂',
                        data: Array.from({length: 24}, (_, i) => Math.random() * 5 + (i > 8 && i < 18 ? 10 : 5)),
                        borderColor: '#a1c4fd',
                        backgroundColor: 'rgba(161, 196, 253, 0.2)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    },
                    {
                        label: 'Food CO₂',
                        data: Array.from({length: 24}, (_, i) => Math.random() * 3 + (i > 11 && i < 14 ? 8 : (i > 18 && i < 20 ? 6 : 3))),
                        borderColor: '#84fab0',
                        backgroundColor: 'rgba(132, 250, 176, 0.2)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    },
                    {
                        label: 'Energy CO₂',
                        data: Array.from({length: 24}, (_, i) => Math.random() * 4 + (i > 6 && i < 22 ? 7 : 2)),
                        borderColor: '#ffecd2',
                        backgroundColor: 'rgba(255, 236, 210, 0.2)',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: true,
                        pointRadius: 3,
                        pointHoverRadius: 5
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            usePointStyle: true,
                            padding: 20
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'kg CO₂',
                            color: 'rgba(0, 0, 0, 0.7)'
                        },
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: 'rgba(0, 0, 0, 0.7)'
                        }
                    }
                }
            }
        });

        // Vitamin D Page Functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Tab Switching
            document.getElementById('auto-detect').addEventListener('click', function() {
                this.classList.add('active');
                document.getElementById('manual-input').classList.remove('active');
                document.getElementById('auto-section').style.display = 'block';
                document.getElementById('manual-section').style.display = 'none';
            });

            document.getElementById('manual-input').addEventListener('click', function() {
                this.classList.add('active');
                document.getElementById('auto-detect').classList.remove('active');
                document.getElementById('auto-section').style.display = 'none';
                document.getElementById('manual-section').style.display = 'block';
            });

            // Location Detection
            document.getElementById('get-location').addEventListener('click', function() {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        function(position) {
                            const lat = position.coords.latitude;
                            const lng = position.coords.longitude;
                            calculateVitaminD(lat, lng);
                        },
                        function(error) {
                            alert('Error getting location: ' + error.message);
                        }
                    );
                } else {
                    alert('Geolocation is not supported by your browser');
                }
            });

            // Country/City Selection
            const countries = {
                'AF': { name: 'Afghanistan', flag: 'https://flagcdn.com/w40/af.png', cities: ['Kabul', 'Kandahar', 'Herat', 'Mazar-i-Sharif'] },
                'AL': { name: 'Albania', flag: '🇦🇱', cities: ['Tirana', 'Durrës', 'Vlorë'] },
                'DZ': { name: 'Algeria', flag: '🇩🇿', cities: ['Algiers', 'Oran', 'Constantine', 'Annaba'] },
                'US': { name: 'United States', flag: '🇺🇸', cities: ['New York', 'Los Angeles', 'Chicago'] },
                'GB': { name: 'United Kingdom', flag: '🇬🇧', cities: ['London', 'Manchester', 'Birmingham'] },
                // Add more countries as needed
            };

            const countrySelect = document.getElementById('country-select');
            const citySelect = document.getElementById('city-select');

            // Populate country dropdown
            function populateCountries() {
                countrySelect.innerHTML = '<option value="">Select Country</option>';
                for (const [code, countryData] of Object.entries(countries)) {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = `${countryData.flag} ${countryData.name}`;
                    countrySelect.appendChild(option);
                }
            }

            // Handle country change to populate cities
            countrySelect.addEventListener('change', function() {
                citySelect.innerHTML = '<option value="">Select City</option>';
                citySelect.disabled = !this.value;
                
                if (this.value) {
                    const countryCities = countries[this.value].cities;
                    countryCities.forEach(city => {
                        const option = document.createElement('option');
                        option.value = city;
                        option.textContent = city;
                        citySelect.appendChild(option);
                    });
                }
            });

            // Initialize country dropdown
            populateCountries();

            // Vitamin D Calculation
            function calculateVitaminD(lat, lng) {
                const uvIndex = fetch_uv_index(lat, lng);
                const exposure = parseInt(document.getElementById('exposure-time').value);
                const skinType = document.getElementById('skin-type').value;
                
                document.getElementById('current-uv').textContent = uvIndex.toFixed(1);
                
                const recommendedTime = calculateRecommendedTime(uvIndex, skinType);
                document.getElementById('recommended-time').textContent = recommendedTime + ' min';
                
                const level = estimate_level(uvIndex, exposure);
                document.getElementById('vitamin-level').textContent = level;
            }

            function calculateRecommendedTime(uvIndex, skinType) {
                return Math.round((30 / uvIndex) * (6 / skinType));
            }

            // Mock functions (replace with actual implementations)
            function fetch_uv_index(lat, lng) {
                // Mock implementation - returns random UV index between 1-10
                return Math.random() * 9 + 1;
            }

            function estimate_level(uvIndex, exposure) {
                // Mock implementation - returns a random vitamin D level
                const levels = ['Low', 'Moderate', 'Sufficient', 'High'];
                return levels[Math.floor(Math.random() * levels.length)];
            }
        });

        // Chart Initialization
        const vitaminCtx = document.getElementById('vitaminChart').getContext('2d');
        const vitaminChart = new Chart(vitaminCtx, {
            type: 'line',
            data: {
                labels: Array.from({length: 7}, (_, i) => {
                    const d = new Date();
                    d.setDate(d.getDate() - 6 + i);
                    return d.toLocaleDateString('en', {weekday: 'short'});
                }),
                datasets: [{
                    label: 'UV Index',
                    data: Array.from({length: 7}, () => Math.random() * 5 + 3),
                    borderColor: '#ff9a9e',
                    backgroundColor: 'rgba(255, 154, 158, 0.2)',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }, {
                    label: 'Recommended Minutes',
                    data: Array.from({length: 7}, () => Math.random() * 20 + 10),
                    borderColor: '#a1c4fd',
                    backgroundColor: 'rgba(161, 196, 253, 0.2)',
                    borderWidth: 2,
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });

        // Resize charts on window resize
        window.addEventListener('resize', function() {
            tempChart.resize();
            phChart.resize();
            analyticsChart.resize();
            co2Chart.resize();
            vitaminChart.resize();
        });

        // Note Modal Functionality
        const newNoteBtn = document.getElementById('newNoteBtn');
        const addNoteBtn = document.getElementById('addNoteBtn');
        const noteModal = document.getElementById('noteModal');
        const noteModalClose = noteModal.querySelector('.note-modal-close');

        newNoteBtn.addEventListener('click', () => {
            noteModal.style.display = 'block';
        });

        addNoteBtn.addEventListener('click', () => {
            noteModal.style.display = 'block';
        });

        noteModalClose.addEventListener('click', () => {
            noteModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === noteModal) {
                noteModal.style.display = 'none';
            }
        });

        // Profile Modal
        setTimeout(() => {
            const modal = document.getElementById("profileModal");
            const editBtn = document.querySelector(".edit-profile i");
            const closeBtn = document.querySelector(".modal .close");

            if (editBtn && modal && closeBtn) {
             editBtn.onclick = () => modal.style.display = "block";
             closeBtn.onclick = () => modal.style.display = "none";
            window.onclick = (e) => { if (e.target === modal) modal.style.display = "none"; };
             }
            }, 100); 

        // EcoBot AI Assistant
        const chatbotMessages = document.getElementById("aiMessages");
        const chatbotInput = document.getElementById("aiInput");
        const sendBtn = document.getElementById("aiSend");
        const aiBtn = document.getElementById("aiAssistantBtn");
        const aiContainer = document.getElementById("aiAssistantContainer");
        const aiCloseBtn = document.getElementById("aiAssistantClose");
        
        let chatHistory = [
            { role: "system", content: "You are a helpful assistant for a sustainability dashboard. Be polite, ethical, and friendly. Help users with their carbon footprint, vitamin D from sunlight, UV index, and health behaviors." },
            { role: "assistant", content: "Hi! Ask me anything about your carbon footprint, sunlight, or vitamin D." }
        ];

        const appendMessage = (role, text) => {
            const msg = document.createElement("div");
            msg.className = `ai-message ${role}`;
            msg.textContent = text;
            chatbotMessages.appendChild(msg);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        };

        const sendMessage = async () => {
            const userInput = chatbotInput.value.trim();
            if (!userInput) return;

            appendMessage("user", userInput);
            chatHistory.push({ role: "user", content: userInput });
            chatbotInput.value = "";

            appendMessage("bot", "...");
            try {
                const res = await fetch("https://ecobot-backend.onrender.com/api/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ messages: chatHistory })
                });
                const data = await res.json();
                chatbotMessages.lastChild.remove();
                appendMessage("bot", data.reply);
                chatHistory.push({ role: "assistant", content: data.reply });
            } catch (err) {
                chatbotMessages.lastChild.remove();
                appendMessage("bot", "Oops, something went wrong.");
            }
        };

        // Toggle AI Assistant
        aiBtn.addEventListener('click', () => {
            aiContainer.classList.toggle('active');
        });

        aiCloseBtn.addEventListener('click', () => {
            aiContainer.classList.remove('active');
        });

        // Send message on button click or enter
        sendBtn.onclick = sendMessage;
        chatbotInput.addEventListener("keydown", e => {
            if (e.key === "Enter") sendMessage();
        });

        // Quick action buttons
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const action = this.getAttribute('data-action');
                let message = '';
                
                switch(action) {
                    case 'footprint':
                        message = "How can I reduce my carbon footprint?";
                        break;
                    case 'vitaminD':
                        message = "How much sunlight do I need for vitamin D?";
                        break;
                    case 'tips':
                        message = "Give me some eco-friendly living tips";
                        break;
                }
                
                chatbotInput.value = message;
                sendMessage();
            });
        });

        // Initialize with welcome message
        appendMessage("bot", "Hi! Ask me anything about your carbon footprint, sunlight, or vitamin D.");
    </script>
</body>
</html>